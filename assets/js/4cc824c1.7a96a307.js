"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[84850],{1085:(e,t,a)=>{a.d(t,{Z:()=>n});const n={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64c247.4 0 448 200.6 448 448S759.4 960 512 960 64 759.4 64 512 264.6 64 512 64zm127.98 274.82h-.04l-.08.06L512 466.75 384.14 338.88c-.04-.05-.06-.06-.08-.06a.12.12 0 00-.07 0c-.03 0-.05.01-.09.05l-45.02 45.02a.2.2 0 00-.05.09.12.12 0 000 .07v.02a.27.27 0 00.06.06L466.75 512 338.88 639.86c-.05.04-.06.06-.06.08a.12.12 0 000 .07c0 .03.01.05.05.09l45.02 45.02a.2.2 0 00.09.05.12.12 0 00.07 0c.02 0 .04-.01.08-.05L512 557.25l127.86 127.87c.04.04.06.05.08.05a.12.12 0 00.07 0c.03 0 .05-.01.09-.05l45.02-45.02a.2.2 0 00.05-.09.12.12 0 000-.07v-.02a.27.27 0 00-.05-.06L557.25 512l127.87-127.86c.04-.04.05-.06.05-.08a.12.12 0 000-.07c0-.03-.01-.05-.05-.09l-45.02-45.02a.2.2 0 00-.09-.05.12.12 0 00-.07 0z"}}]},name:"close-circle",theme:"filled"}},8913:(e,t,a)=>{a.d(t,{Z:()=>l});var n=a(1413),r=a(67294),o=a(1085),s=a(89099),i=function(e,t){return r.createElement(s.Z,(0,n.Z)((0,n.Z)({},e),{},{ref:t,icon:o.Z}))};i.displayName="CloseCircleFilled";const l=r.forwardRef(i)},3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>d});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),u=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},p=function(e){var t=u(e.components);return n.createElement(l.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),c=u(a),h=r,d=c["".concat(l,".").concat(h)]||c[h]||m[h]||o;return a?n.createElement(d,s(s({ref:t},p),{},{components:a})):n.createElement(d,s({ref:t},p))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,s=new Array(o);s[0]=h;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[c]="string"==typeof e?e:r,s[1]=i;for(var u=2;u<o;u++)s[u]=a[u];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},53502:(e,t,a)=>{a.d(t,{Z:()=>b});var n=a(67294),r=a(86010);const o="availabilityCard_P5od",s="managedIcon_AxXO",i="platform_wqXv",l="platformAvailable_Y8lN";var u=a(8913),p=a(1413);const c={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm193.5 301.7l-210.6 292a31.8 31.8 0 01-51.7 0L318.5 484.9c-3.8-5.3 0-12.7 6.5-12.7h46.9c10.2 0 19.9 4.9 25.9 13.3l71.2 98.8 157.2-218c6-8.3 15.6-13.3 25.9-13.3H699c6.5 0 10.3 7.4 6.5 12.7z"}}]},name:"check-circle",theme:"filled"};var m=a(89099),h=function(e,t){return n.createElement(m.Z,(0,p.Z)((0,p.Z)({},e),{},{ref:t,icon:c}))};h.displayName="CheckCircleFilled";const d=n.forwardRef(h);const g={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M811.4 418.7C765.6 297.9 648.9 212 512.2 212S258.8 297.8 213 418.6C127.3 441.1 64 519.1 64 612c0 110.5 89.5 200 199.9 200h496.2C870.5 812 960 722.5 960 612c0-92.7-63.1-170.7-148.6-193.3zm36.3 281a123.07 123.07 0 01-87.6 36.3H263.9c-33.1 0-64.2-12.9-87.6-36.3A123.3 123.3 0 01140 612c0-28 9.1-54.3 26.2-76.3a125.7 125.7 0 0166.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10c54.3 14.5 92.1 63.8 92.1 120 0 33.1-12.9 64.3-36.3 87.7z"}}]},name:"cloud",theme:"outlined"};var k=function(e,t){return n.createElement(m.Z,(0,p.Z)((0,p.Z)({},e),{},{ref:t,icon:g}))};k.displayName="CloudOutlined";const y=n.forwardRef(k),b=e=>{let{saasOnly:t,ossOnly:a}=e;return n.createElement("div",{className:(0,r.Z)(o,"card")},n.createElement("strong",null,"Feature Availability"),n.createElement("div",null,n.createElement("span",{className:(0,r.Z)(i,!t&&l)},"Self-Hosted DataHub ",t?n.createElement(u.Z,null):n.createElement(d,null))),n.createElement("div",null,n.createElement(y,{className:s}),n.createElement("span",{className:(0,r.Z)(i,!a&&l)},"Managed DataHub ",a?n.createElement(u.Z,null):n.createElement(d,null))))}},19803:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>u,contentTitle:()=>i,default:()=>h,frontMatter:()=>s,metadata:()=>l,toc:()=>p});var n=a(87462),r=(a(67294),a(3905)),o=a(53502);const s={description:"This page provides an overview of working with DataHub SQL Assertions",title:"Custom SQL Assertions",slug:"/managed-datahub/observe/custom-sql-assertions",custom_edit_url:"https://github.com/datahub-project/datahub/blob/master/docs/managed-datahub/observe/custom-sql-assertions.md"},i="Custom SQL Assertions",l={unversionedId:"docs/managed-datahub/observe/custom-sql-assertions",id:"docs/managed-datahub/observe/custom-sql-assertions",title:"Custom SQL Assertions",description:"This page provides an overview of working with DataHub SQL Assertions",source:"@site/genDocs/docs/managed-datahub/observe/custom-sql-assertions.md",sourceDirName:"docs/managed-datahub/observe",slug:"/managed-datahub/observe/custom-sql-assertions",permalink:"/docs/next/managed-datahub/observe/custom-sql-assertions",draft:!1,editUrl:"https://github.com/datahub-project/datahub/blob/master/docs/managed-datahub/observe/custom-sql-assertions.md",tags:[],version:"current",frontMatter:{description:"This page provides an overview of working with DataHub SQL Assertions",title:"Custom SQL Assertions",slug:"/managed-datahub/observe/custom-sql-assertions",custom_edit_url:"https://github.com/datahub-project/datahub/blob/master/docs/managed-datahub/observe/custom-sql-assertions.md"},sidebar:"overviewSidebar",previous:{title:"Volume Assertions",permalink:"/docs/next/managed-datahub/observe/volume-assertions"},next:{title:"Managing Lineage via UI",permalink:"/docs/next/features/feature-guides/ui-lineage"}},u={},p=[{value:"Introduction",id:"introduction",level:2},{value:"Support",id:"support",level:2},{value:"What is a Custom SQL Assertion?",id:"what-is-a-custom-sql-assertion",level:2},{value:"Anatomy of a Custom SQL Assertion",id:"anatomy-of-a-custom-sql-assertion",level:3},{value:"1. Evaluation Schedule",id:"1-evaluation-schedule",level:4},{value:"2. Query",id:"2-query",level:4},{value:"3. Condition Type",id:"3-condition-type",level:4},{value:"4. Assertion Description",id:"4-assertion-description",level:4},{value:"Creating a Custom SQL Assertion",id:"creating-a-custom-sql-assertion",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Steps",id:"steps",level:3},{value:"Stopping a Custom SQL Assertion",id:"stopping-a-custom-sql-assertion",level:2},{value:"Creating Custom SQL Assertions via API",id:"creating-custom-sql-assertions-via-api",level:2},{value:"GraphQL",id:"graphql",level:4},{value:"Examples",id:"examples",level:5},{value:"Tips",id:"tips",level:3}],c={toc:p},m="wrapper";function h(e){let{components:t,...a}=e;return(0,r.kt)(m,(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"custom-sql-assertions"},"Custom SQL Assertions"),(0,r.kt)(o.Z,{saasOnly:!0,mdxType:"FeatureAvailability"}),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u26a0\ufe0f The ",(0,r.kt)("strong",{parentName:"p"},"Custom SQL Assertions")," feature is currently in private beta, part of the ",(0,r.kt)("strong",{parentName:"p"},"Acryl Observe")," module, and may only be available to a\nlimited set of design partners."),(0,r.kt)("p",{parentName:"blockquote"},"If you are interested in trying it and providing feedback, please reach out to your Acryl Customer Success\nrepresentative.")),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"Can you remember a time when the meaning of Data Warehouse Table that you depended on fundamentally changed, with little or no notice?\nIf the answer is yes, how did you find out? We'll take a guess - someone looking at an internal reporting dashboard or worse, a user using your your product, sounded an alarm when\na number looked a bit out of the ordinary. Perhaps your table initially tracked purchases made on your company's e-commerce web store, but suddenly began to include purchases made\nthrough your company's new mobile app. "),(0,r.kt)("p",null,"There are many reasons why an important Table on Snowflake, Redshift, or BigQuery may change in its meaning - application code bugs, new feature rollouts,\nchanges to key metric definitions, etc. Often times, these changes break important assumptions made about the data used in building key downstream data products\nlike reporting dashboards or data-driven product features."),(0,r.kt)("p",null,"What if you could reduce the time to detect these incidents, so that the people responsible for the data were made aware of data\nissues ",(0,r.kt)("em",{parentName:"p"},"before")," anyone else? With Acryl DataHub ",(0,r.kt)("strong",{parentName:"p"},"Custom SQL Assertions"),", you can."),(0,r.kt)("p",null,"Acryl DataHub allows users to define complex expectations about a particular warehouse Table through custom SQL queries, and then monitor those expectations over time as the table grows and changes."),(0,r.kt)("p",null,"In this article, we'll cover the basics of monitoring Custom SQL Assertions - what they are, how to configure them, and more - so that you and your team can\nstart building trust in your most important data assets."),(0,r.kt)("p",null,"Let's get started!"),(0,r.kt)("h2",{id:"support"},"Support"),(0,r.kt)("p",null,"Custom SQL Assertions are currently supported for:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Snowflake"),(0,r.kt)("li",{parentName:"ol"},"Redshift"),(0,r.kt)("li",{parentName:"ol"},"BigQuery")),(0,r.kt)("p",null,"Note that an Ingestion Source ",(0,r.kt)("em",{parentName:"p"},"must")," be configured with the data platform of your choice in Acryl DataHub's ",(0,r.kt)("strong",{parentName:"p"},"Ingestion"),"\ntab."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Note that SQL Assertions are not yet supported if you are connecting to your warehouse\nusing the DataHub CLI or a Remote Ingestion Executor.")),(0,r.kt)("h2",{id:"what-is-a-custom-sql-assertion"},"What is a Custom SQL Assertion?"),(0,r.kt)("p",null,"A ",(0,r.kt)("strong",{parentName:"p"},"Custom SQL Assertion")," is a highly configurable Data Quality rule used to monitor a Data Warehouse Table\nfor unexpected or sudden changes in its meaning. Custom SQL Assertions are defined through a raw SQL query that is evaluated against\nthe Table. You have full control over the SQL query, and can use any SQL features supported by your Data Warehouse.\nCustom SQL Assertions can be particularly useful when you have complex tables or relationships\nthat are used to generate important metrics or reports, and where the meaning of the table is expected to be stable over time.\nIf you have existing SQL queries that you already use to monitor your data, you may find that Custom SQL Assertions are an easy way to port them\nto Acryl DataHub to get started."),(0,r.kt)("p",null,"For example, imagine that you have a Table that tracks the number of purchases made on your company's e-commerce web store.\nYou have a SQL query that you use to calculate the number of purchases made in the past 24 hours, and you'd like to monitor this\nmetric over time to ensure that it is always greater than 1000. You can use a Custom SQL Assertion to do this!"),(0,r.kt)("h3",{id:"anatomy-of-a-custom-sql-assertion"},"Anatomy of a Custom SQL Assertion"),(0,r.kt)("p",null,"At the most basic level, ",(0,r.kt)("strong",{parentName:"p"},"Custom SQL Assertions")," consist of a few important parts:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"An ",(0,r.kt)("strong",{parentName:"li"},"Evaluation Schedule")),(0,r.kt)("li",{parentName:"ol"},"A ",(0,r.kt)("strong",{parentName:"li"},"Query")),(0,r.kt)("li",{parentName:"ol"},"An ",(0,r.kt)("strong",{parentName:"li"},"Condition Type")),(0,r.kt)("li",{parentName:"ol"},"An ",(0,r.kt)("strong",{parentName:"li"},"Assertion Description"))),(0,r.kt)("p",null,"In this section, we'll give an overview of each."),(0,r.kt)("h4",{id:"1-evaluation-schedule"},"1. Evaluation Schedule"),(0,r.kt)("p",null,"The ",(0,r.kt)("strong",{parentName:"p"},"Evaluation Schedule"),": This defines how often to query the given warehouse Table. This should usually\nbe configured to match the expected change frequency of the Table, although it can also be less frequently depending\non the requirements. You can also specify specific days of the week, hours in the day, or even\nminutes in an hour."),(0,r.kt)("h4",{id:"2-query"},"2. Query"),(0,r.kt)("p",null,"The ",(0,r.kt)("strong",{parentName:"p"},"Query"),": This is the SQL query that will be used to evaluate the Table. The query should return a ",(0,r.kt)("strong",{parentName:"p"},"single row")," containing a ",(0,r.kt)("strong",{parentName:"p"},"single numeric column")," (integers, floats).\nThe query can be as simple or as complex as you'd like, and can use any SQL features supported by your Data Warehouse. This requires that the configured user account has read access to the asset. Make sure to use the fully qualified name of the Table in your query."),(0,r.kt)("p",null,'Use the "Try it out" button to test your query and ensure that it returns a single row with a single column. The query will be run against the Table in the context of the configured user account, so ensure that the user has read access to the Table.'),(0,r.kt)("h4",{id:"3-condition-type"},"3. Condition Type"),(0,r.kt)("p",null,"The ",(0,r.kt)("strong",{parentName:"p"},"Condition Type"),": This defines the conditions under which the Assertion will ",(0,r.kt)("strong",{parentName:"p"},"fail"),". The list of supported operations is:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Is Equal To"),": The assertion will fail if the query result is equal to the configured value"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Is Not Equal To"),": The assertion will fail if the query result is not equal to the configured value"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Is Greater Than"),": The assertion will fail if the query result is greater than the configured value"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Is Less Than"),": The assertion will fail if the query result is less than the configured value"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Is Outside a Range"),": The assertion will fail if the query result is outside the configured range"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Grows More Than"),": The assertion will fail if the query result grows more than the configured range. This can be either a percentage (",(0,r.kt)("strong",{parentName:"li"},"Percentage"),") or a number (",(0,r.kt)("strong",{parentName:"li"},"Value"),")."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Grows Less Than"),": The assertion will fail if the query result grows less than the configured percentage. This can be either a percentage (",(0,r.kt)("strong",{parentName:"li"},"Percentage"),") or a number (",(0,r.kt)("strong",{parentName:"li"},"Value"),")."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Growth is outside a range"),": The assertion will fail if the query result growth is outside the configured range. This can be either a percentage (",(0,r.kt)("strong",{parentName:"li"},"Percentage"),") or a number (",(0,r.kt)("strong",{parentName:"li"},"Value"),").")),(0,r.kt)("p",null,"Custom SQL Assertions also have an off switch: they can be started or stopped at any time with the click of button."),(0,r.kt)("h4",{id:"4-assertion-description"},"4. Assertion Description"),(0,r.kt)("p",null,"The ",(0,r.kt)("strong",{parentName:"p"},"Assertion Description"),": This is a human-readable description of the Assertion. It should be used to describe the meaning of the Assertion, and can be used to provide additional context to users who are viewing the Assertion."),(0,r.kt)("h2",{id:"creating-a-custom-sql-assertion"},"Creating a Custom SQL Assertion"),(0,r.kt)("h3",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Permissions"),": To create or delete Custom SQL Assertions for a specific entity on DataHub, you'll need to be granted the\n",(0,r.kt)("inlineCode",{parentName:"p"},"Edit Assertions")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Edit Monitors")," privileges for the entity. This is granted to Entity owners by default.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Data Platform Connection"),": In order to create a Custom SQL Assertion, you'll need to have an ",(0,r.kt)("strong",{parentName:"p"},"Ingestion Source")," configured to your\nData Platform: Snowflake, BigQuery, or Redshift under the ",(0,r.kt)("strong",{parentName:"p"},"Integrations")," tab."))),(0,r.kt)("p",null,"Once these are in place, you're ready to create your Custom SQL Assertions!"),(0,r.kt)("h3",{id:"steps"},"Steps"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Navigate to the Table you want to monitor"),(0,r.kt)("li",{parentName:"ol"},"Click the ",(0,r.kt)("strong",{parentName:"li"},"Validations")," tab")),(0,r.kt)("p",{align:"center"},(0,r.kt)("img",{width:"90%",src:"https://raw.githubusercontent.com/datahub-project/static-assets/main/imgs/observe/freshness/profile-validation-tab.png"})),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Click ",(0,r.kt)("strong",{parentName:"li"},"+ Create Assertion"))),(0,r.kt)("p",{align:"center"},(0,r.kt)("img",{width:"90%",src:"https://raw.githubusercontent.com/datahub-project/static-assets/main/imgs/observe/custom/assertion-builder-custom-choose-type.png"})),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Choose ",(0,r.kt)("strong",{parentName:"p"},"Custom"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Configure the evaluation ",(0,r.kt)("strong",{parentName:"p"},"schedule"),". This is the frequency at which the assertion will be evaluated to produce a pass or fail result, and the times\nwhen the query will be executed.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Provide a SQL ",(0,r.kt)("strong",{parentName:"p"},"query")," that will be used to evaluate the Table. The query should return a single row with a single column. Currently only numeric values are supported (integer and floats). The query can be as simple or as complex as you'd like, and can use any SQL features supported by your Data Warehouse. Make sure to use the fully qualified name of the Table in your query."))),(0,r.kt)("p",{align:"center"},(0,r.kt)("img",{width:"60%",src:"https://raw.githubusercontent.com/datahub-project/static-assets/main/imgs/observe/custom/assertion-builder-custom-query-editor.png"})),(0,r.kt)("ol",{start:7},(0,r.kt)("li",{parentName:"ol"},"Configure the evaluation ",(0,r.kt)("strong",{parentName:"li"},"condition type"),". This determines the cases in which the new assertion will fail when it is evaluated.")),(0,r.kt)("p",{align:"center"},(0,r.kt)("img",{width:"60%",src:"https://raw.githubusercontent.com/datahub-project/static-assets/main/imgs/observe/custom/assertion-builder-custom-condition-type.png"})),(0,r.kt)("ol",{start:8},(0,r.kt)("li",{parentName:"ol"},"Add a ",(0,r.kt)("strong",{parentName:"li"},"description")," for the assertion. This is a human-readable description of the Assertion. It should be used to describe the meaning of the Assertion, and can be used to provide additional context to users who are viewing the Assertion.")),(0,r.kt)("p",{align:"center"},(0,r.kt)("img",{width:"60%",src:"https://raw.githubusercontent.com/datahub-project/static-assets/main/imgs/observe/custom/assertion-builder-custom-description.png"})),(0,r.kt)("ol",{start:9},(0,r.kt)("li",{parentName:"ol"},"(Optional) Use the ",(0,r.kt)("strong",{parentName:"li"},"Try it out")," button to test your query and ensure that it returns a single row with a single column, and passes the configured condition type.")),(0,r.kt)("p",{align:"center"},(0,r.kt)("img",{width:"60%",src:"https://raw.githubusercontent.com/datahub-project/static-assets/main/imgs/observe/custom/assertion-builder-custom-try-it-out.png"})),(0,r.kt)("ol",{start:10},(0,r.kt)("li",{parentName:"ol"},"Click ",(0,r.kt)("strong",{parentName:"li"},"Next")),(0,r.kt)("li",{parentName:"ol"},"Configure actions that should be taken when the Custom SQL Assertion passes or fails")),(0,r.kt)("p",{align:"left"},(0,r.kt)("img",{width:"45%",src:"https://raw.githubusercontent.com/datahub-project/static-assets/main/imgs/observe/freshness/assertion-builder-actions.png"})),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Raise incident"),": Automatically raise a new DataHub Incident for the Table whenever the Custom SQL Assertion is failing. This\nmay indicate that the Table is unfit for consumption. Configure Slack Notifications under ",(0,r.kt)("strong",{parentName:"li"},"Settings")," to be notified when\nan incident is created due to an Assertion failure."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Resolve incident"),": Automatically resolved any incidents that were raised due to failures in this Custom SQL Assertion. Note that\nany other incidents will not be impacted.")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Click ",(0,r.kt)("strong",{parentName:"li"},"Save"),".")),(0,r.kt)("p",null,"And that's it! DataHub will now begin to monitor your Custom SQL Assertion for the table."),(0,r.kt)("p",null,"To view the time of the next Custom SQL Assertion evaluation, simply click ",(0,r.kt)("strong",{parentName:"p"},"Custom")," and then click on your\nnew Assertion:"),(0,r.kt)("p",{align:"center"},(0,r.kt)("img",{width:"40%",src:"https://raw.githubusercontent.com/datahub-project/static-assets/main/imgs/observe/freshness/assertion-next-evaluation-time.png"})),(0,r.kt)("p",null,"Once your assertion has run, you will begin to see Success or Failure status for the Table"),(0,r.kt)("p",{align:"center"},(0,r.kt)("img",{width:"90%",src:"https://raw.githubusercontent.com/datahub-project/static-assets/main/imgs/observe/custom/profile-passing-custom-assertions-expanded.png"})),(0,r.kt)("h2",{id:"stopping-a-custom-sql-assertion"},"Stopping a Custom SQL Assertion"),(0,r.kt)("p",null,"In order to temporarily stop the evaluation of a Custom SQL Assertion:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Navigate to the ",(0,r.kt)("strong",{parentName:"li"},"Validations")," tab of the Table with the assertion"),(0,r.kt)("li",{parentName:"ol"},"Click ",(0,r.kt)("strong",{parentName:"li"},"Custom")," to open the Custom SQL Assertions list"),(0,r.kt)("li",{parentName:"ol"},"Click the three-dot menu on the right side of the assertion you want to disable"),(0,r.kt)("li",{parentName:"ol"},"Click ",(0,r.kt)("strong",{parentName:"li"},"Stop"))),(0,r.kt)("p",{align:"left"},(0,r.kt)("img",{width:"25%",src:"https://raw.githubusercontent.com/datahub-project/static-assets/main/imgs/observe/freshness/manage-assertion-menu.png"})),(0,r.kt)("p",null,"To resume the Custom SQL Assertion, simply click ",(0,r.kt)("strong",{parentName:"p"},"Turn On"),"."),(0,r.kt)("p",{align:"center"},(0,r.kt)("img",{width:"90%",src:"https://raw.githubusercontent.com/datahub-project/static-assets/main/imgs/observe/freshness/stopped-assertion.png"})),(0,r.kt)("h2",{id:"creating-custom-sql-assertions-via-api"},"Creating Custom SQL Assertions via API"),(0,r.kt)("p",null,'Under the hood, Acryl DataHub implements Custom SQL Assertion Monitoring using two "entity" concepts:'),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Assertion"),': The specific expectation for the custom assertion, e.g. "The table was changed in the past 7 hours"\nor "The table is changed on a schedule of every day by 8am". This is the "what".')),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Monitor"),': The process responsible for evaluating the Assertion on a given evaluation schedule and using specific\nmechanisms. This is the "how".'))),(0,r.kt)("p",null,"Note that to create or delete Assertions and Monitors for a specific entity on DataHub, you'll need the\n",(0,r.kt)("inlineCode",{parentName:"p"},"Edit Assertions")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Edit Monitors")," privileges for it."),(0,r.kt)("h4",{id:"graphql"},"GraphQL"),(0,r.kt)("p",null,"In order to create a Custom SQL Assertion that is being monitored on a specific ",(0,r.kt)("strong",{parentName:"p"},"Evaluation Schedule"),", you'll need to use 2\nGraphQL mutation queries to create a Custom SQL Assertion entity and create an Assertion Monitor entity responsible for evaluating it."),(0,r.kt)("p",null,"Start by creating the Custom SQL Assertion entity using the ",(0,r.kt)("inlineCode",{parentName:"p"},"createSqlAssertion")," query and hang on to the 'urn' field of the Assertion entity\nyou get back. Then continue by creating a Monitor entity using the ",(0,r.kt)("inlineCode",{parentName:"p"},"createAssertionMonitor"),"."),(0,r.kt)("h5",{id:"examples"},"Examples"),(0,r.kt)("p",null,"To create a Custom SQL Assertion Entity that checks whether a query result is greater than 100:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'mutation createSqlAssertion {\n  createSqlAssertion(\n    input: {\n      entityUrn: "<urn of the table to be monitored>",\n      type: METRIC,\n      description: "<description of the custom assertion>",\n      statement: "<SQL query to be evaluated>",\n      operator: GREATER_THAN,\n      parameters: {\n        value: {\n          value: "100",\n          type: NUMBER\n        }\n      }\n    }\n  ) {\n    urn\n  }\n}\n')),(0,r.kt)("p",null,"The supported assertion types are ",(0,r.kt)("inlineCode",{parentName:"p"},"METRIC")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"METRIC_CHANGE"),". If you choose ",(0,r.kt)("inlineCode",{parentName:"p"},"METRIC_CHANGE"),",\nyou will need to provide a ",(0,r.kt)("inlineCode",{parentName:"p"},"changeType")," parameter with either ",(0,r.kt)("inlineCode",{parentName:"p"},"ABSOLUTE")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"PERCENTAGE")," values.\nThe supported operator types are ",(0,r.kt)("inlineCode",{parentName:"p"},"EQUAL_TO"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"NOT_EQUAL_TO"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"GREATER_THAN"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"GREATER_THAN_OR_EQUAL_TO"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"LESS_THAN"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"LESS_THAN_OR_EQUAL_TO"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"BETWEEN")," (requires minValue, maxValue).\nThe supported parameter types are ",(0,r.kt)("inlineCode",{parentName:"p"},"NUMBER"),". "),(0,r.kt)("p",null,"To create an Assertion Monitor Entity that evaluates the custom assertion every 8 hours:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'mutation createAssertionMonitor {\n  createAssertionMonitor(\n    input: {\n      entityUrn: "<urn of entity being monitored>",\n      assertionUrn: "<urn of assertion created in first query>",\n      schedule: {\n        cron: "0 */8 * * *",\n        timezone: "America/Los_Angeles"\n      },\n      parameters: {\n        type: DATASET_SQL\n      }\n    }\n  ) {\n    urn\n  }\n}\n')),(0,r.kt)("p",null,"This entity defines ",(0,r.kt)("em",{parentName:"p"},"when")," to run the check (Using CRON format - every 8th hour) and ",(0,r.kt)("em",{parentName:"p"},"how")," to run the check (using the Information Schema)."),(0,r.kt)("p",null,"After creating the monitor, the new assertion will start to be evaluated every 8 hours in your selected timezone."),(0,r.kt)("p",null,"You can delete assertions along with their monitors using GraphQL mutations: ",(0,r.kt)("inlineCode",{parentName:"p"},"deleteAssertion")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"deleteMonitor"),"."),(0,r.kt)("h3",{id:"tips"},"Tips"),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("strong",{parentName:"p"},"Authorization")),(0,r.kt)("p",{parentName:"admonition"},"Remember to always provide a DataHub Personal Access Token when calling the GraphQL API. To do so, just add the 'Authorization' header as follows:"),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre"},"Authorization: Bearer <personal-access-token>\n")),(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("strong",{parentName:"p"},"Exploring GraphQL API")),(0,r.kt)("p",{parentName:"admonition"},"Also, remember that you can play with an interactive version of the Acryl GraphQL API at ",(0,r.kt)("inlineCode",{parentName:"p"},"https://your-account-id.acryl.io/api/graphiql"))))}h.isMDXComponent=!0}}]);