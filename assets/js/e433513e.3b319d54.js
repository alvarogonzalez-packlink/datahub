"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[90076],{3905:(e,t,r)=>{r.d(t,{Zo:()=>l,kt:()=>b});var n=r(67294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var s=n.createContext({}),u=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):c(c({},t),e)),r},l=function(e){var t=u(e.components);return n.createElement(s.Provider,{value:t},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),d=u(r),h=o,b=d["".concat(s,".").concat(h)]||d[h]||p[h]||a;return r?n.createElement(b,c(c({ref:t},l),{},{components:r})):n.createElement(b,c({ref:t},l))}));function b(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=r.length,c=new Array(a);c[0]=h;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[d]="string"==typeof e?e:o,c[1]=i;for(var u=2;u<a;u++)c[u]=r[u];return n.createElement.apply(null,c)}return n.createElement.apply(null,r)}h.displayName="MDXCreateElement"},28953:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>b,frontMatter:()=>i,metadata:()=>u,toc:()=>d});r(67294);var n=r(3905);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function c(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}const i={title:"Restoring Search and Graph Indices from Local Database",slug:"/how/restore-indices",custom_edit_url:"https://github.com/datahub-project/datahub/blob/master/docs/how/restore-indices.md"},s="Restoring Search and Graph Indices from Local Database",u={unversionedId:"docs/how/restore-indices",id:"docs/how/restore-indices",title:"Restoring Search and Graph Indices from Local Database",description:"If search or graph services go down or you have made changes to them that require reindexing, you can restore them from",source:"@site/genDocs/docs/how/restore-indices.md",sourceDirName:"docs/how",slug:"/how/restore-indices",permalink:"/docs/next/how/restore-indices",draft:!1,editUrl:"https://github.com/datahub-project/datahub/blob/master/docs/how/restore-indices.md",tags:[],version:"current",frontMatter:{title:"Restoring Search and Graph Indices from Local Database",slug:"/how/restore-indices",custom_edit_url:"https://github.com/datahub-project/datahub/blob/master/docs/how/restore-indices.md"},sidebar:"overviewSidebar",previous:{title:"Taking backup of DataHub",permalink:"/docs/next/how/backup-datahub"},next:{title:"Configuring Database Retention",permalink:"/docs/next/advanced/db-retention"}},l={},d=[{value:"Quickstart",id:"quickstart",level:2},{value:"Docker-compose",id:"docker-compose",level:2},{value:"Kubernetes",id:"kubernetes",level:2},{value:"Through API",id:"through-api",level:2}],p={toc:d},h="wrapper";function b(e){var{components:t}=e,r=c(e,["components"]);return(0,n.kt)(h,a(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){o(e,t,r[t])}))}return e}({},p,r),{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"restoring-search-and-graph-indices-from-local-database"},"Restoring Search and Graph Indices from Local Database"),(0,n.kt)("p",null,"If search or graph services go down or you have made changes to them that require reindexing, you can restore them from\nthe aspects stored in the local database."),(0,n.kt)("p",null,"When a new version of the aspect gets ingested, GMS initiates an MAE event for the aspect which is consumed to update\nthe search and graph indices. As such, we can fetch the latest version of each aspect in the local database and produce\nMAE events corresponding to the aspects to restore the search and graph indices."),(0,n.kt)("h2",{id:"quickstart"},"Quickstart"),(0,n.kt)("p",null,"If you're using the quickstart images, you can use the ",(0,n.kt)("inlineCode",{parentName:"p"},"datahub")," cli to restore indices."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"datahub docker quickstart --restore-indices\n")),(0,n.kt)("p",null,"See ",(0,n.kt)("a",{parentName:"p",href:"/docs/next/quickstart#restoring-only-the-index-use-with-care"},"this section")," for more information. "),(0,n.kt)("h2",{id:"docker-compose"},"Docker-compose"),(0,n.kt)("p",null,"If you are on a custom docker-compose deployment, run the following command (you need to checkout ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/datahub-project/datahub"},"the source repository"),") from the root of the repo to send MAE for each aspect in the Local DB."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"./docker/datahub-upgrade/datahub-upgrade.sh -u RestoreIndices\n")),(0,n.kt)("p",null,"If you need to clear the search and graph indices before restoring, add ",(0,n.kt)("inlineCode",{parentName:"p"},"-a clean")," to the end of the command."),(0,n.kt)("p",null,"Refer to this ",(0,n.kt)("a",{parentName:"p",href:"/docs/next/docker/datahub-upgrade#environment-variables"},"doc")," on how to set environment variables\nfor your environment."),(0,n.kt)("h2",{id:"kubernetes"},"Kubernetes"),(0,n.kt)("p",null,"Run ",(0,n.kt)("inlineCode",{parentName:"p"},"kubectl get cronjobs")," to see if the restoration job template has been deployed. If you see results like below, you\nare good to go."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"NAME                                          SCHEDULE    SUSPEND   ACTIVE   LAST SCHEDULE   AGE\ndatahub-datahub-cleanup-job-template          * * * * *   True      0        <none>          2d3h\ndatahub-datahub-restore-indices-job-template  * * * * *   True      0        <none>          2d3h\n")),(0,n.kt)("p",null,"If not, deploy latest helm charts to use this functionality."),(0,n.kt)("p",null,"Once restore indices job template has been deployed, run the following command to start a job that restores indices."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"kubectl create job --from=cronjob/datahub-datahub-restore-indices-job-template datahub-restore-indices-adhoc\n")),(0,n.kt)("p",null,"Once the job completes, your indices will have been restored. "),(0,n.kt)("h2",{id:"through-api"},"Through API"),(0,n.kt)("p",null,"See ",(0,n.kt)("a",{parentName:"p",href:"/docs/next/api/restli/restore-indices"},"Restore Indices API"),"."))}b.isMDXComponent=!0}}]);